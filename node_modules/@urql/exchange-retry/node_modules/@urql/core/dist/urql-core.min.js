Object.defineProperty(exports,"__esModule",{value:!0});var e=require("graphql"),r=require("./4418f5de.min.js"),t=require("wonka"),n=(e,r)=>{if(Array.isArray(e))for(var t of e)n(t,r);else if("object"==typeof e&&null!==e)for(var a in e)"__typename"===a&&"string"==typeof e[a]?r.add(e[a]):n(e[a],r);return r},a=r=>{if(!r.selectionSet)return r;for(var t of r.selectionSet.selections)if(t.kind===e.Kind.FIELD&&"__typename"===t.name.value&&!t.alias)return r;return{...r,selectionSet:{...r.selectionSet,selections:[...r.selectionSet.selections,{kind:e.Kind.FIELD,name:{kind:e.Kind.NAME,value:"__typename"}}]}}},o=new Map,i=t=>{var n=r.keyDocument(t),i=o.get(n.__key);return i||(i=e.visit(n,{Field:a,InlineFragment:a}),Object.defineProperty(i,"__key",{value:n.__key,enumerable:!1}),o.set(n.__key,i)),i},s=(e,r)=>{if(e&&"object"==typeof e){if(Array.isArray(e))return e.map((e=>s(e)));if(e&&"object"==typeof e&&(r||"__typename"in e)){var t={};for(var n in e)"__typename"===n?Object.defineProperty(t,"__typename",{enumerable:!1,value:e.__typename}):t[n]=s(e[n]);return t}return e}return e};function u(e){return e.toPromise=()=>new Promise((r=>{var n=t.subscribe((e=>{e.stale||e.hasNext||Promise.resolve().then((()=>{n.unsubscribe(),r(e)}))}))(e)})),e}function c(e,r,t){return t||(t=r.context),{key:r.key,query:r.query,variables:r.variables,kind:e,context:t}}var p=(e,r)=>c(e.kind,e,{...e.context,meta:{...e.context.meta,...r}}),l=()=>{},d=(t,n,a)=>{for(var o of a)if(o.kind===e.Kind.FRAGMENT_DEFINITION){var i=o.name.value,s=r.stringifyDocument(o);t.has(i)||(t.set(i,s),n.push(o))}else n.push(o)},y=({kind:e})=>"mutation"!==e&&"query"!==e,k=({forward:e,client:r})=>{var a=new Map,o=new Map,s=e=>{var r=c(e.kind,e);return r.query=i(e.query),r},u=e=>{var{key:r,kind:t,context:{requestPolicy:n}}=e;return"query"===t&&"network-only"!==n&&("cache-only"===n||a.has(r))};return i=>{var c=t.share(i),l=t.map((e=>{var t=a.get(e.key),n={...t,operation:p(e,{cacheOutcome:t?"hit":"miss"})};return"cache-and-network"===e.context.requestPolicy&&(n.stale=!0,f(r,e)),n}))(t.filter((e=>!y(e)&&u(e)))(c)),d=t.tap((e=>{var{operation:t}=e;if(t){var i=(e=>[...n(e,new Set)])(e.data).concat(t.context.additionalTypenames||[]);if("mutation"===e.operation.kind){for(var s=new Set,u=0;u<i.length;u++){var c=i[u],p=o.get(c);for(var l of(p||o.set(c,p=new Set),p.values()))s.add(l);p.clear()}for(var d of s.values())a.has(d)&&(t=a.get(d).operation,a.delete(d),f(r,t))}else if("query"===t.kind&&e.data){a.set(t.key,e);for(var y=0;y<i.length;y++){var k=i[y],m=o.get(k);m||o.set(k,m=new Set),m.add(t.key)}}}}))(e(t.filter((e=>"query"!==e.kind||"cache-only"!==e.context.requestPolicy))(t.map((e=>p(e,{cacheOutcome:"miss"})))(t.merge([t.map(s)(t.filter((e=>!y(e)&&!u(e)))(c)),t.filter((e=>y(e)))(c)])))));return t.merge([l,d])}},f=(e,r)=>e.reexecuteOperation(c(r.kind,r,{...r.context,requestPolicy:"network-only"})),m=new Set,x=({forward:e})=>{var r=new Set,n=e=>{var{key:t,kind:n}=e;if("teardown"===n||"mutation"===n)return r.delete(t),!0;var a=r.has(t);return r.add(t),!a},a=({operation:e,hasNext:t})=>{t||r.delete(e.key)};return r=>{var o=t.filter(n)(r);return t.tap(a)(e(o))}},h=({forward:e})=>n=>{var a=t.share(n),o=t.mergeMap((e=>{var{key:n}=e,o=r.makeFetchBody(e),i=r.makeFetchURL(e,o),s=r.makeFetchOptions(e,o);return t.takeUntil(t.filter((e=>"teardown"===e.kind&&e.key===n))(a))(r.makeFetchSource(e,i,s))}))(t.filter((e=>"query"===e.kind||"mutation"===e.kind))(a)),i=e(t.filter((e=>"query"!==e.kind&&"mutation"!==e.kind))(a));return t.merge([o,i])},v=({})=>e=>t.filter((()=>!1))(t.tap((e=>{}))(e)),g=v({dispatchDebug:l}),b=e=>({client:r,forward:t})=>e.reduceRight(((e,t)=>t({client:r,forward:e,dispatchDebug(e){}})),t),q=[x,k,h],w=function e(n){var a=new Map,o=new Map,i=[],p={url:n.url,fetchOptions:n.fetchOptions,fetch:n.fetch,preferGetMethod:!!n.preferGetMethod,requestPolicy:n.requestPolicy||"cache-first"},{source:d,next:y}=t.makeSubject(),k=!1;function f(e){if(e&&y(e),!k){for(k=!0;k&&(e=i.shift());)y(e);k=!1}}var m=e=>{var r=t.filter((r=>r.operation.kind===e.kind&&r.operation.key===e.key&&(!r.operation.context._instance||r.operation.context._instance===e.context._instance)))(E);return n.maskTypename&&(r=t.map((e=>({...e,data:s(e.data,!0)})))(r)),"mutation"===e.kind?t.take(1)(t.onStart((()=>y(e)))(r)):t.share(t.onEnd((()=>{a.delete(e.key),o.delete(e.key);for(var r=i.length-1;r>=0;r--)i[r].key===e.key&&i.splice(r,1);y(c("teardown",e,e.context))}))(t.onPush((r=>{a.set(e.key,r)}))(t.switchMap((r=>"query"!==e.kind||r.stale?t.fromValue(r):t.merge([t.fromValue(r),t.map((()=>({...r,stale:!0})))(t.take(1)(t.filter((r=>"query"===r.kind&&r.key===e.key&&"cache-only"!==r.context.requestPolicy))(d)))])))(t.takeUntil(t.filter((r=>"teardown"===r.kind&&r.key===e.key))(d))(r)))))},x=this instanceof e?this:Object.create(e.prototype),h=Object.assign(x,{suspense:!!n.suspense,operations$:d,reexecuteOperation(e){("mutation"===e.kind||o.has(e.key))&&(i.push(e),Promise.resolve().then(f))},createRequestOperation:(e,t,n)=>(n||(n={}),r.getOperationType(t.query),c(e,t,{_instance:"mutation"===e?[]:void 0,...p,...n,requestPolicy:n.requestPolicy||p.requestPolicy,suspense:n.suspense||!1!==n.suspense&&h.suspense})),executeRequestOperation:e=>"mutation"===e.kind?m(e):t.make((r=>{var n=o.get(e.key);n||o.set(e.key,n=m(e));var i="cache-and-network"===e.context.requestPolicy||"network-only"===e.context.requestPolicy;return t.subscribe(r.next)(t.onEnd((()=>{k=!1,r.complete()}))(t.onStart((()=>{var t=a.get(e.key);if("subscription"===e.kind)return f(e);i&&f(e),null!=t&&t===a.get(e.key)?r.next(i?{...t,stale:!0}:t):i||f(e)}))(n))).unsubscribe})),executeQuery(e,r){var t=h.createRequestOperation("query",e,r);return h.executeRequestOperation(t)},executeSubscription(e,r){var t=h.createRequestOperation("subscription",e,r);return h.executeRequestOperation(t)},executeMutation(e,r){var t=h.createRequestOperation("mutation",e,r);return h.executeRequestOperation(t)},query:(e,t,n)=>(n&&"boolean"==typeof n.suspense||(n={...n,suspense:!1}),u(h.executeQuery(r.createRequest(e,t),n))),readQuery(e,r,n){var a=null;return t.subscribe((e=>{a=e}))(h.query(e,r,n)).unsubscribe(),a},subscription:(e,t,n)=>h.executeSubscription(r.createRequest(e,t),n),mutation:(e,t,n)=>u(h.executeMutation(r.createRequest(e,t),n))}),g=l,w=b(void 0!==n.exchanges?n.exchanges:q),E=t.share(w({client:h,dispatchDebug:g,forward:v({dispatchDebug:g})})(d));return t.publish(E),h},E=w;exports.CombinedError=r.CombinedError,exports.createRequest=r.createRequest,exports.getOperationName=r.getOperationName,exports.makeErrorResult=r.makeErrorResult,exports.makeResult=r.makeResult,exports.mergeResultPatch=r.mergeResultPatch,exports.stringifyVariables=r.stringifyVariables,exports.Client=w,exports.cacheExchange=k,exports.composeExchanges=b,exports.createClient=E,exports.debugExchange=({forward:e})=>r=>e(r),exports.dedupExchange=x,exports.defaultExchanges=q,exports.errorExchange=({onError:e})=>({forward:r})=>n=>t.tap((({error:r,operation:t})=>{r&&e(r,t)}))(r(n)),exports.fallbackExchangeIO=g,exports.fetchExchange=h,exports.formatDocument=i,exports.gql=function(){for(var t=new Map,n=[],a=[],o=Array.isArray(arguments[0])?arguments[0][0]:arguments[0]||"",i=1;i<arguments.length;i++){var s=arguments[i];s&&s.definitions?a.push(...s.definitions):o+=s,o+=arguments[0][i]}return d(t,n,r.keyDocument(o).definitions),d(t,n,a),r.keyDocument({kind:e.Kind.DOCUMENT,definitions:n})},exports.makeOperation=c,exports.maskTypename=s,exports.ssrExchange=(e={})=>{var n=!!e.staleWhileRevalidate,a=!!e.includeExtensions,o={},i=[],s=e=>{i.push(e.operation.key),1===i.length&&Promise.resolve().then((()=>{for(var e;e=i.shift();)o[e]=null}))},u=({client:i,forward:u})=>c=>{var p=e&&"boolean"==typeof e.isClient?!!e.isClient:!i.suspense,l=t.share(c),d=u(t.filter((e=>!o[e.key]||!!o[e.key].hasNext))(l)),y=t.map((e=>{var t=((e,t,n)=>({operation:e,data:t.data?JSON.parse(t.data):void 0,extensions:n&&t.extensions?JSON.parse(t.extensions):void 0,error:t.error?new r.CombinedError({networkError:t.error.networkError?new Error(t.error.networkError):void 0,graphQLErrors:t.error.graphQLErrors}):void 0,hasNext:t.hasNext}))(e,o[e.key],a);return n&&!m.has(e.key)&&(t.stale=!0,m.add(e.key),f(i,e)),t}))(t.filter((e=>!!o[e.key]&&"network-only"!==e.context.requestPolicy))(l));return p?y=t.tap(s)(y):d=t.tap((e=>{var{operation:r}=e;if("mutation"!==r.kind){var t=(({hasNext:e,data:r,extensions:t,error:n},a)=>{var o={};return void 0!==r&&(o.data=JSON.stringify(r)),a&&void 0!==t&&(o.extensions=JSON.stringify(t)),e&&(o.hasNext=!0),n&&(o.error={graphQLErrors:n.graphQLErrors.map((e=>e.path||e.extensions?{message:e.message,path:e.path,extensions:e.extensions}:e.message))},n.networkError&&(o.error.networkError=""+n.networkError)),o})(e,a);o[r.key]=t}}))(d),t.merge([d,y])};return u.restoreData=e=>{for(var r in e)null!==o[r]&&(o[r]=e[r])},u.extractData=()=>{var e={};for(var r in o)null!=o[r]&&(e[r]=o[r]);return e},e&&e.initialState&&u.restoreData(e.initialState),u},exports.subscriptionExchange=({forwardSubscription:n,enableAllOperations:a,isSubscriptionOperation:o})=>({client:i,forward:s})=>{var u=o||(e=>{var{kind:r}=e;return"subscription"===r||!!a&&("query"===r||"mutation"===r)});return a=>{var o=t.share(a),p=t.mergeMap((a=>{var{key:s}=a,u=t.filter((e=>"teardown"===e.kind&&e.key===s))(o);return t.takeUntil(u)((a=>{var o=n({key:a.key.toString(36),query:e.print(a.query),variables:a.variables,context:{...a.context}});return t.make((({next:e,complete:t})=>{var n,s=!1;return Promise.resolve().then((()=>{s||(n=o.subscribe({next:t=>e(r.makeResult(a,t)),error:t=>e(r.makeErrorResult(a,t)),complete:()=>{s||(s=!0,"subscription"===a.kind&&i.reexecuteOperation(c("teardown",a,a.context)),t())}}))})),()=>{s=!0,n&&n.unsubscribe()}}))})(a))}))(t.filter(u)(o)),l=s(t.filter((e=>!u(e)))(o));return t.merge([p,l])}};
//# sourceMappingURL=urql-core.min.js.map
