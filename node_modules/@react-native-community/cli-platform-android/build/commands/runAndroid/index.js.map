{"version":3,"sources":["../../../src/commands/runAndroid/index.ts"],"names":["runAndroid","_argv","config","args","androidProject","jetifier","logger","info","chalk","bold","dim","require","resolve","stdio","error","CLIError","packager","buildAndRun","port","then","result","warn","startServerInNewWindow","terminal","reactNativePath","message","process","chdir","sourceDir","cmd","platform","startsWith","adbPath","deviceId","runOnSpecificDevice","gradlew","devices","adb","getDevices","length","indexOf","buildApk","installAndLaunchOnDevice","gradleArgs","debug","join","execa","sync","cwd","tryInstallAppOnDevice","device","appName","variant","toLowerCase","buildDirectory","apkFile","getInstallApkName","pathToApk","adbArgs","availableCPUs","getAvailableCPUs","availableCPU","concat","apkName","fs","existsSync","selectedDevice","packageName","isWindows","test","scriptFile","packagerEnvFilename","portExportContent","launchPackagerScript","path","scriptsDir","dirname","packagerEnvFile","procConfig","writeFileSync","encoding","flag","detached","name","description","func","options","default","env","RCT_METRO_PORT","parse","Number","val","split"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\nimport path from 'path';\nimport execa from 'execa';\nimport chalk from 'chalk';\nimport fs from 'fs';\nimport {Config} from '@react-native-community/cli-types';\nimport adb from './adb';\nimport runOnAllDevices from './runOnAllDevices';\nimport tryRunAdbReverse from './tryRunAdbReverse';\nimport tryLaunchAppOnDevice from './tryLaunchAppOnDevice';\nimport getAdbPath from './getAdbPath';\nimport {\n  isPackagerRunning,\n  logger,\n  getDefaultUserTerminal,\n  CLIError,\n} from '@react-native-community/cli-tools';\nimport {getAndroidProject} from '../../config/getAndroidProject';\n\nexport interface Flags {\n  tasks?: Array<string>;\n  variant: string;\n  appId: string;\n  appIdSuffix: string;\n  mainActivity: string;\n  deviceId?: string;\n  packager: boolean;\n  port: number;\n  terminal: string;\n  jetifier: boolean;\n  activeArchOnly: boolean;\n}\n\ntype AndroidProject = NonNullable<Config['project']['android']>;\n\n/**\n * Starts the app on a connected Android emulator or device.\n */\nasync function runAndroid(_argv: Array<string>, config: Config, args: Flags) {\n  const androidProject = getAndroidProject(config);\n\n  if (args.jetifier) {\n    logger.info(\n      `Running ${chalk.bold(\n        'jetifier',\n      )} to migrate libraries to AndroidX. ${chalk.dim(\n        'You can disable it using \"--no-jetifier\" flag.',\n      )}`,\n    );\n\n    try {\n      await execa(require.resolve('jetifier/bin/jetify'), {stdio: 'inherit'});\n    } catch (error) {\n      throw new CLIError('Failed to run jetifier.', error);\n    }\n  }\n\n  if (!args.packager) {\n    return buildAndRun(args, androidProject);\n  }\n\n  return isPackagerRunning(args.port).then((result: string) => {\n    if (result === 'running') {\n      logger.info('JS server already running.');\n    } else if (result === 'unrecognized') {\n      logger.warn('JS server not recognized, continuing with build...');\n    } else {\n      // result == 'not_running'\n      logger.info('Starting JS server...');\n      try {\n        startServerInNewWindow(\n          args.port,\n          args.terminal,\n          config.reactNativePath,\n        );\n      } catch (error) {\n        logger.warn(\n          `Failed to automatically start the packager server. Please run \"react-native start\" manually. Error details: ${error.message}`,\n        );\n      }\n    }\n    return buildAndRun(args, androidProject);\n  });\n}\n\n// Builds the app and runs it on a connected emulator / device.\nfunction buildAndRun(args: Flags, androidProject: AndroidProject) {\n  process.chdir(androidProject.sourceDir);\n  const cmd = process.platform.startsWith('win') ? 'gradlew.bat' : './gradlew';\n\n  const adbPath = getAdbPath();\n  if (args.deviceId) {\n    return runOnSpecificDevice(args, cmd, adbPath, androidProject);\n  } else {\n    return runOnAllDevices(args, cmd, adbPath, androidProject);\n  }\n}\n\nfunction runOnSpecificDevice(\n  args: Flags,\n  gradlew: 'gradlew.bat' | './gradlew',\n  adbPath: string,\n  androidProject: AndroidProject,\n) {\n  const devices = adb.getDevices(adbPath);\n  const {deviceId} = args;\n  if (devices.length > 0 && deviceId) {\n    if (devices.indexOf(deviceId) !== -1) {\n      buildApk(gradlew, androidProject.sourceDir);\n      installAndLaunchOnDevice(args, deviceId, adbPath, androidProject);\n    } else {\n      logger.error(\n        `Could not find device with the id: \"${deviceId}\". Please choose one of the following:`,\n        ...devices,\n      );\n    }\n  } else {\n    logger.error('No Android device or emulator connected.');\n  }\n}\n\nfunction buildApk(gradlew: string, sourceDir: string) {\n  try {\n    // using '-x lint' in order to ignore linting errors while building the apk\n    const gradleArgs = ['build', '-x', 'lint'];\n    logger.info('Building the app...');\n    logger.debug(`Running command \"${gradlew} ${gradleArgs.join(' ')}\"`);\n    execa.sync(gradlew, gradleArgs, {stdio: 'inherit', cwd: sourceDir});\n  } catch (error) {\n    throw new CLIError('Failed to build the app.', error);\n  }\n}\n\nfunction tryInstallAppOnDevice(\n  args: Flags,\n  adbPath: string,\n  device: string,\n  androidProject: AndroidProject,\n) {\n  try {\n    // \"app\" is usually the default value for Android apps with only 1 app\n    const {appName, sourceDir} = androidProject;\n    const variant = args.variant.toLowerCase();\n    const buildDirectory = `${sourceDir}/${appName}/build/outputs/apk/${variant}`;\n    const apkFile = getInstallApkName(\n      appName,\n      adbPath,\n      variant,\n      device,\n      buildDirectory,\n    );\n\n    const pathToApk = `${buildDirectory}/${apkFile}`;\n    const adbArgs = ['-s', device, 'install', '-r', '-d', pathToApk];\n    logger.info(`Installing the app on the device \"${device}\"...`);\n    logger.debug(\n      `Running command \"cd android && adb -s ${device} install -r -d ${pathToApk}\"`,\n    );\n    execa.sync(adbPath, adbArgs, {stdio: 'inherit'});\n  } catch (error) {\n    throw new CLIError('Failed to install the app on the device.', error);\n  }\n}\n\nfunction getInstallApkName(\n  appName: string,\n  adbPath: string,\n  variant: string,\n  device: string,\n  buildDirectory: string,\n) {\n  const availableCPUs = adb.getAvailableCPUs(adbPath, device);\n\n  // check if there is an apk file like app-armeabi-v7a-debug.apk\n  for (const availableCPU of availableCPUs.concat('universal')) {\n    const apkName = `${appName}-${availableCPU}-${variant}.apk`;\n    if (fs.existsSync(`${buildDirectory}/${apkName}`)) {\n      return apkName;\n    }\n  }\n\n  // check if there is a default file like app-debug.apk\n  const apkName = `${appName}-${variant}.apk`;\n  if (fs.existsSync(`${buildDirectory}/${apkName}`)) {\n    return apkName;\n  }\n\n  throw new CLIError('Could not find the correct install APK file.');\n}\n\nfunction installAndLaunchOnDevice(\n  args: Flags,\n  selectedDevice: string,\n  adbPath: string,\n  androidProject: AndroidProject,\n) {\n  tryRunAdbReverse(args.port, selectedDevice);\n  tryInstallAppOnDevice(args, adbPath, selectedDevice, androidProject);\n  tryLaunchAppOnDevice(\n    selectedDevice,\n    androidProject.packageName,\n    adbPath,\n    args,\n  );\n}\n\nfunction startServerInNewWindow(\n  port: number,\n  terminal: string,\n  reactNativePath: string,\n) {\n  /**\n   * Set up OS-specific filenames and commands\n   */\n  const isWindows = /^win/.test(process.platform);\n  const scriptFile = isWindows\n    ? 'launchPackager.bat'\n    : 'launchPackager.command';\n  const packagerEnvFilename = isWindows ? '.packager.bat' : '.packager.env';\n  const portExportContent = isWindows\n    ? `set RCT_METRO_PORT=${port}`\n    : `export RCT_METRO_PORT=${port}`;\n\n  /**\n   * Set up the `.packager.(env|bat)` file to ensure the packager starts on the right port.\n   */\n  const launchPackagerScript = path.join(\n    reactNativePath,\n    `scripts/${scriptFile}`,\n  );\n\n  /**\n   * Set up the `launchpackager.(command|bat)` file.\n   * It lives next to `.packager.(bat|env)`\n   */\n  const scriptsDir = path.dirname(launchPackagerScript);\n  const packagerEnvFile = path.join(scriptsDir, packagerEnvFilename);\n  const procConfig: execa.SyncOptions = {cwd: scriptsDir};\n\n  /**\n   * Ensure we overwrite file by passing the `w` flag\n   */\n  fs.writeFileSync(packagerEnvFile, portExportContent, {\n    encoding: 'utf8',\n    flag: 'w',\n  });\n\n  if (process.platform === 'darwin') {\n    try {\n      return execa.sync(\n        'open',\n        ['-a', terminal, launchPackagerScript],\n        procConfig,\n      );\n    } catch (error) {\n      return execa.sync('open', [launchPackagerScript], procConfig);\n    }\n  }\n  if (process.platform === 'linux') {\n    try {\n      return execa.sync(terminal, ['-e', `sh ${launchPackagerScript}`], {\n        ...procConfig,\n        detached: true,\n      });\n    } catch (error) {\n      // By default, the child shell process will be attached to the parent\n      return execa.sync('sh', [launchPackagerScript], procConfig);\n    }\n  }\n  if (/^win/.test(process.platform)) {\n    // Awaiting this causes the CLI to hang indefinitely, so this must execute without await.\n    return execa('cmd.exe', ['/C', launchPackagerScript], {\n      ...procConfig,\n      detached: true,\n      stdio: 'ignore',\n    });\n  }\n  logger.error(\n    `Cannot start the packager. Unknown platform ${process.platform}`,\n  );\n  return;\n}\n\nexport default {\n  name: 'run-android',\n  description:\n    'builds your app and starts it on a connected Android emulator or device',\n  func: runAndroid,\n  options: [\n    {\n      name: '--variant <string>',\n      description: \"Specify your app's build variant\",\n      default: 'debug',\n    },\n    {\n      name: '--appId <string>',\n      description:\n        'Specify an applicationId to launch after build. If not specified, `package` from AndroidManifest.xml will be used.',\n      default: '',\n    },\n    {\n      name: '--appIdSuffix <string>',\n      description: 'Specify an applicationIdSuffix to launch after build.',\n      default: '',\n    },\n    {\n      name: '--main-activity <string>',\n      description: 'Name of the activity to start',\n      default: 'MainActivity',\n    },\n    {\n      name: '--deviceId <string>',\n      description:\n        'builds your app and starts it on a specific device/simulator with the ' +\n        'given device id (listed by running \"adb devices\" on the command line).',\n    },\n    {\n      name: '--no-packager',\n      description: 'Do not launch packager while building',\n    },\n    {\n      name: '--port <number>',\n      default: process.env.RCT_METRO_PORT || 8081,\n      parse: Number,\n    },\n    {\n      name: '--terminal <string>',\n      description:\n        'Launches the Metro Bundler in a new window using the specified terminal path.',\n      default: getDefaultUserTerminal(),\n    },\n    {\n      name: '--tasks <list>',\n      description: 'Run custom Gradle tasks. By default it\\'s \"installDebug\"',\n      parse: (val: string) => val.split(','),\n    },\n    {\n      name: '--no-jetifier',\n      description:\n        'Do not run \"jetifier\" – the AndroidX transition tool. By default it runs before Gradle to ease working with libraries that don\\'t support AndroidX yet. See more at: https://www.npmjs.com/package/jetifier.',\n    },\n    {\n      name: '--active-arch-only',\n      description:\n        'Build native libraries only for the current device architecture for debug builds.',\n      default: false,\n    },\n  ],\n};\n"]}